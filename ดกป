const WEBHOOK_URL = "https://discord.com/api/webhooks/1452979360926793748/ypsrr6WPejaFYeMn5zpsOL5OiTNUgJLW4IWKzPQlddNv3UmqovhADcjeRtz4k3gMXsL9";

function sendWebhook(title, description, color = 3066993) {
  fetch(WEBHOOK_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      embeds: [{
        title: title,
        description: description,
        color: color,
        footer: {
          text: "Duty System"
        },
        timestamp: new Date()
      }]
    })
  });
}

// ------------------------------

let staffList = JSON.parse(localStorage.getItem("staffList")) || [];

function save() {
  localStorage.setItem("staffList", JSON.stringify(staffList));
  render();
}

function render() {
  const table = document.getElementById("staffTable");
  table.innerHTML = "";

  staffList.forEach((s, i) => {
    const h = Math.floor((s.totalMinutes || 0) / 60);
    const m = (s.totalMinutes || 0) % 60;

    let dutyStatus = "‚õî ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£";
    let dutyTime = "-";
    let forceBtn = "";

    if (s.isOnDuty && s.dutyStart) {
      dutyStatus = "üü¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£";
      const minutes = Math.floor((Date.now() - s.dutyStart) / 60000);
      dutyTime = `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;

      forceBtn = `<button class="danger" onclick="forceCheckOut(${i})">üö® Force ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£</button>`;
    }

    table.innerHTML += `
      <tr>
        <td>
          <input value="${s.name}" onchange="editName(${i}, this.value)">
        </td>
        <td>
          ${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ
          <br>
          <small>${dutyStatus} (${dutyTime})</small>
        </td>
        <td>
          ${forceBtn}
          <button onclick="removeStaff(${i})">üóëÔ∏è</button>
        </td>
      </tr>
    `;
  });
}


// ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà
function saveStaffList() {
  localStorage.setItem("staffList", JSON.stringify(staffList));
}

function addStaff() {
  const name = document.getElementById("newName").value.trim();
  if (!name) return;

  staffList.push({
    name: name,
    totalMinutes: 0,
    isOnDuty: false,
    dutyStart: null
  });

  saveStaffList(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage
  render();
}
  sendWebhook(
    "‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà",
    `üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${name}\nüõ† ‡πÇ‡∏î‡∏¢ Admin`,
    3447003
  );

  document.getElementById("newName").value = "";
  save();


// üóë ‡∏•‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà
function removeStaff(index) {
  const staffName = staffList[index].name;

  if (!confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ?")) return;

  staffList.splice(index, 1);

  sendWebhook(
    "üóë ‡∏•‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà",
    `üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${staffName}`,
    15158332
  );

  save();
}

// ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠
function editName(index, newName) {
  newName = newName.trim();
  if (!newName) return;

  const oldName = staffList[index].name;
  if (oldName === newName) return;

  staffList[index].name = newName;

  sendWebhook(
    "‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà",
    `‡∏à‡∏≤‡∏Å: ${oldName}\n‡πÄ‡∏õ‡πá‡∏ô: ${newName}`,
    15844367
  );

  save();
}





// üóë ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
function removeConfirm(index) {
  const confirmName = confirmList[index].name;

  if (!confirm(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ: ${confirmName}?`)) return;

  confirmList.splice(index, 1);

  sendWebhook(
    "üóë ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
    `üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${confirmName}`,
    15158332
  );

  saveConfirmList();
}

// ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
function editnewConfirmName(index, newName) {
  newName = newName.trim();
  if (!newName) return;

  const oldName = confirmList[index].name;
  if (oldName === newName) return;

  confirmList[index].name = newName;

  sendWebhook(
    "‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
    `‡∏à‡∏≤‡∏Å: ${oldName}\n‡πÄ‡∏õ‡πá‡∏ô: ${newName}`,
    15844367
  );

  saveConfirmList();
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
function saveConfirmList() {
  localStorage.setItem("confirmList", JSON.stringify(confirmList));
  renderConfirmList();
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
function renderConfirmList() {
  const confirmTable = document.getElementById("confirmTable");
  confirmTable.innerHTML = "";

  confirmList.forEach((c, i) => {
    confirmTable.innerHTML += `
      <tr>
        <td>
          <input id="newConfirmName-${i}" value="${c.name}" onchange="editnewConfirmName(${i}, this.value)">
        </td>
        <td>
          <button onclick="removeConfirm(${i})">üóëÔ∏è ‡∏•‡∏ö</button>
        </td>
      </tr>
    `;
  });
}

function forceCheckOut(index) {
  const staff = staffList[index];

  if (!staff.isOnDuty || !staff.dutyStart) {
    alert("‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà");
    return;
  }

  if (!confirm(`Force ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£: ${staff.name} ?`)) return;

  const elapsedMinutes = Math.floor((Date.now() - staff.dutyStart) / 60000);

  staff.isOnDuty = false;
  staff.dutyStart = null;
  staff.totalMinutes = (staff.totalMinutes || 0) + elapsedMinutes;

  save();

  sendWebhook(
    "üö® Force ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£ (Admin)",
    `üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${staff.name}
‚è±Ô∏è ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${elapsedMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ
üõ† ‡πÇ‡∏î‡∏¢: Admin`,
    15105570
  );

  alert(`üö® Force ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${elapsedMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ)`);
}


// ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
let confirmList = JSON.parse(localStorage.getItem("confirmList")) || [];
renderConfirmList();

window.addEventListener("storage", () => {
  staffList = JSON.parse(localStorage.getItem("staffList")) || [];
  render();
});



render();
